!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("angular")):"function"==typeof define&&define.amd?define(["angular"],r):"object"==typeof exports?exports.AngularDragDrop=r(require("angular")):t.AngularDragDrop=r(t.angular)}(this,function(t){return function(t){function r(e){if(a[e])return a[e].exports;var n=a[e]={exports:{},id:e,loaded:!1};return t[e].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}var a={};return r.m=t,r.c=a,r.p="",r(0)}([function(t,r,a){var e=a(1);a(!function(){var t=new Error('Cannot find module "./angular-drag-drop.less"');throw t.code="MODULE_NOT_FOUND",t}()),t.exports="filearts.dragDrop";var n=e.module(t.exports,[]);n.factory("dragContext",["$rootElement",function(t){function r(){return e.extend(n,{data:null,reset:r,start:a})}function a(t){return n.data=t,t}var n={};return r()}]),n.run(["$rootElement","$timeout",function(t,r){function a(t){n()}function e(t){n()}function n(){r(function(){t.removeClass("drag-active")})}t[0].addEventListener("dragend",a,!0),t[0].addEventListener("drop",e,!0)}]),n.directive("dragContainer",["$rootElement","$parse","$timeout","dragContext",function(t,r,a,e){return{restrict:"A",link:function(n,o,d){function l(r){if(r.originalEvent.dataTransfer.setData("text","anything"),a(function(){t.addClass("drag-active")},0,!1),e.start(d.dragData?n.$eval(d.dragData):o),o.addClass("drag-container-active"),s){var l={$event:r,$dragData:e.data};n.$apply(function(){s(n,l)})}}function i(r){if(a(function(){t.removeClass("drag-active")},0,!1),e.reset(),o.removeClass("drag-container-active"),g){var d={$event:r,$dragData:e.data};n.$apply(function(){g(n,d)})}e.lastTarget&&e.lastTarget.$attrs.$removeClass("drag-over")}var s=d.onDragStart?r(d.onDragStart):null,g=d.onDragEnd?r(d.onDragEnd):null;d.$addClass("drag-container"),n.$watch(d.dragContainer,function(t){d.$set("draggable","undefined"==typeof t||t)}),o.on("dragstart",l),o.on("dragend",i)}}}]),n.directive("dropContainer",["$document","$parse","$window","dragContext",function(t,r,a,n){function o(t){return t[0]||t}function d(r){r=o(r);var n=r.getBoundingClientRect();return{width:Math.round(e.isNumber(n.width)?n.width:r.offsetWidth),height:Math.round(e.isNumber(n.height)?n.height:r.offsetHeight),top:Math.round(n.top+(a.pageYOffset||t[0].documentElement.scrollTop)),left:Math.round(n.left+(a.pageXOffset||t[0].documentElement.scrollLeft))}}return{restrict:"A",require:"dropContainer",controller:"DropContainerController",controllerAs:"dropContainer",link:function(t,a,o,l){function i(r){n.lastTarget&&n.lastTarget!==a&&n.lastTarget.$attrs.$removeClass("drag-over"),n.lastTarget={$attrs:o,$element:a};var e={$event:r,$dragData:n.data};u(t,e)&&(r.preventDefault(),o.$addClass("drag-over"),p&&t.$apply(function(){p(t,e)}))}function s(r){var i={$event:r,$dragData:n.data};if(u(t,i)){r.preventDefault();var s=d(a);o.$addClass("drag-over");var g=Number.MAX_VALUE,c=s.width,p=s.height,v=r.pageX-s.left,$=r.pageY-s.top,h=l.lastTarget;e.forEach(l.targets,function(t,r){var a=c/2,e=p/2;r.indexOf("left")>=0&&(a=1*c/4),r.indexOf("top")>=0&&(e=1*p/4),r.indexOf("right")>=0&&(a=3*c/4),r.indexOf("bottom")>=0&&(e=3*p/4);var n=Math.pow(a-v,2)+Math.pow(e-$,2);n<g&&(h=t,g=n)}),t.$apply(function(){f&&f(t,i),h&&(h!==l.lastTarget&&(l.lastTarget&&o.$removeClass("drop-container-"+l.lastTarget.anchor),o.$addClass("drop-container-"+h.anchor),l.lastTarget&&l.lastTarget.handleDragLeave(r,i),h.handleDragEnter(r,i),l.lastTarget=h),h.handleDragOver(r))})}}function g(r){o.$removeClass("drag-over");var a={$event:r,$dragData:n.data};t.$apply(function(){v&&v(t,a),l.lastTarget&&l.lastTarget.handleDragLeave(r,a),l.lastTarget&&(o.$removeClass("drop-container-"+l.lastTarget.anchor),l.lastTarget=null)})}function c(r){n.lastTarget&&n.lastTarget.$attrs.$removeClass("drag-over");var a={$event:r,$dragData:n.data};u(t,a)&&(r.preventDefault(),n.reset(),t.$apply(function(){$&&$(t,a),l.lastTarget&&l.lastTarget.handleDrop(r,a)})),l.lastTarget&&o.$removeClass("drop-container-"+l.lastTarget.anchor),l.lastTarget=null}var u=o.dropAccepts?r(o.dropAccepts):function(t,r){return"undefined"!=typeof r.$dragData},p=o.onDragEnter?r(o.onDragEnter):null,f=o.onDragOver?r(o.onDragOver):null,v=o.onDragLeave?r(o.onDragLeave):null,$=o.onDrop?r(o.onDrop):null;o.$addClass("drop-container"),a.on("dragover",s),a.on("dragenter",i),a.on("dragleave",g),a.on("drop",c)}}}]),n.controller("DropContainerController",[function(){var t=this,r="center top top-right right bottom-right bottom bottom-left left top-left".split(" ");t.targets={},t.lastTarget=null,t.attach=function(a){var e=a.anchor;if(r.indexOf(e)<0)throw new Error("Invalid drop target anchor `"+e+"`.");return t.targets[e]=a,a},t.detach=function(a){var e=a.anchor;if(r.indexOf(e)<0)throw new Error("Invalid drop target anchor `"+e+"`.");if(!t.targets[e]===a)throw new Error("The indicated drop target is not attached at the anchor `"+e+"`.");return delete t.targets[e],a}}]),n.directive("dropTarget",["$parse","dragContext",function(t,r){return{restrict:"A",require:["^dropContainer","dropTarget"],scope:!0,bindToController:{anchor:"@dropTarget"},controller:e.noop,controllerAs:"dropTarget",link:function(r,a,n,o){var d=o[0],l=o[1];n.$addClass("drop-target"),l.$attrs=n,l.$scope=r,n.$addClass("drop-target drop-target-"+l.anchor),d.attach(l);var i=l.$attrs.onDragEnter?t(l.$attrs.onDragEnter):e.noop,s=l.$attrs.onDragLeave?t(l.$attrs.onDragLeave):e.noop,g=l.$attrs.onDragOver?t(l.$attrs.onDragOver):e.noop,c=l.$attrs.onDrop?t(l.$attrs.onDrop):e.noop;l.handleDragEnter=function(t,r){i(l.$scope,r)},l.handleDragLeave=function(t,r){s(l.$scope,r)},l.handleDragOver=function(t,r){g(l.$scope,r)},l.handleDrop=function(t,r){c(l.$scope,r)},r.$on("$destroy",function(){d.detach(l)})}}}])},function(r,a){r.exports=t}])});